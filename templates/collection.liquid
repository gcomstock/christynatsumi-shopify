<!-- /templates/collection.liquid -->
{% comment %}

  For more information on collection tags:
    - http://docs.shopify.com/themes/liquid-variables/collection

{% endcomment %}



<script>

  var requestInFlight = false;

   function handleScroll() {
     console.log('scrolling');
     if($(document).height() - 800 < ($(document).scrollTop() + $(window).height())) {
         scrollNode = $('.next').last();
         scrollURL = scrollNode.children('a').attr('href');
         if(scrollNode.length > 0 && scrollNode.css('display') != 'none' && !requestInFlight) {
             requestInFlight = true;
             $.ajax({
                 type: 'GET',
                 url: scrollURL,
                 beforeSend: function() {
                     //scrollNode.clone().empty().insertAfter(scrollNode).append('<img src=\"{{ "loading.gif" | asset_url }}\" />');
                     //scrollNode.hide();
                 },
                 success: function(data) {
                     // remove loading feedback
                     //scrollNode.next().remove();
                     var filteredData = $(data).find('.cn-categoryproduct');
                     $('main').append(filteredData);
                     requestInFlight = false;
                 },
                 dataType: "html"
             });
         }
     }
   }

   $(document).ready(function () {
     $(window).scroll(function(){
        // handleScroll();
         //$.doTimeout( 'scroll', 200, ScrollExecute);
     });
   });

</script>



<main class="cn-wrapper cn-wrapper--top">
  {% paginate collection.products by 48 %}
    {% for product in collection.products %}
      {% include 'product-grid-item' %}
    {% endfor %}

  {% if paginate.pages > 1 %}
    <div class="pagination">
      {{ paginate | default_pagination }}
    </div>
  {% endif %}
  {% endpaginate %}
</main>


{{ 'lazysizes.min.js' | asset_url | script_tag }}
